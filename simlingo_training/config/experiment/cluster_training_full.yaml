# @package _global_
# Cluster训练配置（SimLingo Full - 包含语言能力的完整版本）
# 数据路径指向: /shared/rc/llm-gen-agent/mhu/simlingo_dataset/database
defaults:
  - /data_module: carla_no_buckets.yaml
  - /model/vision_model: vlm
  - /data_module/base_dataset: dataset

model:
  lr: 3e-5
  predict_route_as_wps: True
  speed_wps_mode: 2d
  language_model:
    variant: 'OpenGVLab/InternVL2-1B'
    lora: True
    lora_alpha: 64
    lora_r: 32
    lora_dropout: 0.1
  vision_model:
    variant: 'OpenGVLab/InternVL2-1B'

data_module:
  batch_size: 4  # 根据GPU显存调整（单GPU A100 40GB建议4-6）
  num_workers: 8  # 根据CPU核心数调整（cluster通常有更多CPU）
  dreamer_dataset: null
  base_dataset:
    # Cluster数据路径（绝对路径）
    data_path: /shared/rc/llm-gen-agent/mhu/simlingo_dataset/database/simlingo_extracted
    bucket_path: /shared/rc/llm-gen-agent/mhu/simlingo_dataset/database/bucketsv2_simlingo
    pred_len: 11
    cut_bottom_quarter: True
    use_commentary: False
    use_qa: False
    qa_augmentation: False
    img_shift_augmentation: True
    img_shift_augmentation_prob: 0.5
    hist_len: 1
    route_as: target_point_command
    use_lmdrive_commands: True
    use_old_towns: True
    use_town13: True
    use_safety_flag: True

max_epochs: 15
val_every_n_epochs: 2

# debug: true
gpus: 1  # 单GPU训练（根据SBATCH --gpus-per-node设置）
seed: 42
name: cluster_training_full
resume: False

hydra:
  run:
    dir: outputs/${wandb_name}_${name}

